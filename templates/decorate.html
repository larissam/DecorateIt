{% extends "layout.html" %}

{% block header %}

	<link rel="stylesheet" href="{{ url_for('static', filename='css/main.css')}}">
	<script language="javascript" type="text/javascript" src="{{ url_for('static', filename='js/jquery-1.11.0.min.js')}}"></script>
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='bootstrap/css/bootstrap.css') }}">
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='bootstrap/css/bootstrap-theme.css') }}">
	<script type="text/javascript" src="{{ url_for('static', filename='bootstrap/js/bootstrap.min.js') }}"></script>

	<!-- for the accordion stuff -->
	<link rel="stylesheet" href="{{ url_for('static', filename='jqueryui/jquery-ui.css') }}">
	<script type="text/javascript" src="{{ url_for('static', filename='js/jquery-1.11.0.min.js') }}"></script>
	<script type="text/javascript" src="{{ url_for('static', filename='jqueryui/jquery-ui.js') }}"></script>
	<script>
	$(function() {
		$( "#accordion" ).accordion({
			heightStyle:"fill"
		});
	});
	</script>

	<!-- random styles for this particular page. will be put into a css file later -->
	<style>

		body {
			background-color: #171717;
			margin:0px;
		}
	/* for gallery */
		.gallery {
			display: block;
			text-align: center;
			position: relative;
			padding: .7em .7em .7em .7em;
			min-height: 0;
			font-size: 100%;
			background: #470024;
			border-top: 10px solid black;
		}
		.gallery > img {
			-webkit-filter: opacity(0.4);
		}

		.gallery >img:hover {
			-webkit-filter: opacity(1);
		}
		.gallery-img-active {
			-webkit-filter: opacity(1);
		}

	/* for accordion */
		h3 > img {
			-webkit-filter: invert(1);
		}
		.h3-faux-accordion {
			display: block;
			text-align: center;
			position: relative;
			margin: 2px 0 0 0;
			padding: .5em .5em .5em .7em;
			min-height: 0;
			font-size: 100%;
			height: 48px;
		}

	/* for accordion icons and tool selection */
		button {
			border: none;
			background: none;
			-webkit-filter: opacity(0.4);
		}

		button:hover {
			-webkit-filter: opacity(1);
		}

		button:focus {
			outline: 0 !important;
		}
		.accordion-button-adjustment {
			-webkit-filter: opacity(0.4) !important;
		}

		.icon-inactive {
			display:inline-block; 
			-webkit-filter: invert(1);
		}

		.button-active {
			border: none;
			background: none;
			-webkit-filter: none;
		}

	/* for editor cursors */

		.cursor-marker {
			cursor: url("{{ url_for('static', filename='images/cursormarker.png') }}" ), auto;
		}

		.cursor-brush {
			cursor: url( "{{ url_for('static', filename='images/cursorbrush.png') }}" ), auto;
		}

		.cursor-stamp {
			cursor: url( "{{ url_for('static', filename='images/cursorstamp.png') }}" ), auto;
		}

		.cursor-eraser {
			cursor: url( "{{ url_for('static', filename='images/cursoreraser.png') }}" ), auto;
		}



	</style>

{% endblock %}

{% block content %}

<div class="col-md-9">
	<div style="position: relative;">
		<!-- the javascript gets really jacked up if you move this.
		probably b/c of the mouse placement offset. will look into later. -->

		<!-- 494px height to match with sidebar -->
		<canvas id="photo" width="700" height="494" style="left: 0; top: 0; z-index:0; margin-left:42px; margin-top:127px;"></canvas>
		<canvas id="c" width="700" height="494" style="position: absolute; left: 0; top: 0; z-index:1; margin-left:42px; margin-top:127px;"></canvas>
		<!-- <img src="{{ filename }}" /> -->
	</div>
</div>

<div class="col-md-3" style="position:absolute; right:0; height:700px; margin-right: 10px;">
	<div>
		<!-- margin 0px just for this guy b/c want top plumb with editor window -->
		<h3 class="h3-faux-accordion" style="background-color: #660033; margin:0px;">
			<!-- save will put it in your user account. haven't implemented yet -->
			<button><a id="save"><img src="{{ url_for('static', filename='images/navigatorsave.png') }}" style="height:32px; width:32px" class="icon-inactive"/></a></button>
			<button><a id="download"><img src="{{ url_for('static', filename='images/navigatordownload.png') }}" style="height:32px; width:32px" class="icon-inactive"/></a></button>

		</h3>
	</div>

	<div>
		<div>
			<h3 class="h3-faux-accordion" style="background-color: #8A002E;">
				<button id="changeToolToEraser"><img src="{{ url_for('static', filename='images/navigatoreraser.png') }}" style="height:32px; width:32px" class="icon-inactive"/></button>
				<button id="clear"><img src="{{ url_for('static', filename='images/navigatorreload.png') }}" style="height:32px; width:32px" class="icon-inactive"/></button>
			</h3>
		</div>

		<div>
			<h3 class="h3-faux-accordion" style="background-color: #B8005C;">

				<!-- sizes should be universal. sticking outside for now. still need to implement sizing for brush and stamps -->
				<button id="changeSizeToSmall" ><img src="{{ url_for('static', filename='images/sizesmall.png') }}" title="hai!" style="height:32px; width: 32px" class="icon-inactive"/></button>
				<button id="changeSizeToMedium"><img src="{{ url_for('static', filename='images/sizemedium.png') }}" style="height:32px; width: 32px" class="icon-inactive"/></button>
				<button id="changeSizeToLarge"><img src="{{ url_for('static', filename='images/sizelarge.png') }}" style="height:32px; width: 32px" class="icon-inactive"/></button>
				<button id="changeSizeToXLarge"><img src="{{ url_for('static', filename='images/sizexlarge.png') }}" style="height:32px; width: 32px" class="icon-inactive"/></button>
			</h3>
		</div>

	</div>
	<!-- trying to make accordion height same as editor window. will deal with once window size finalized -->

	<!-- we will also have to set the width of this so it's not dynamic -->
	<div id="accordion">

		
		<h3 style="background-color: #FF5050; text-align: center;"><button><img src="{{ url_for('static', filename='images/navigatormarker.png') }}" class="icon-inactive"/></button></h3>
		<div style="border: 2px solid #FF5050; background-color:white;">
			<button id="changeColorToPurple"><img src="{{ url_for('static', filename='images/brush2a.png') }}" style="height:32px; width:32px" /></button>
			<button id="changeColorToGreen"><img  src="{{ url_for('static', filename='images/brush3a.png') }}" style="height:32px; width:32px" /></button>
			<button id="changeColorToYellow"><img src="{{ url_for('static', filename='images/brush4a.png') }}" style="height:32px; width:32px" /></button>
			<button id="changeColorToPink"><img  src="{{ url_for('static', filename='images/brush1a.png') }}" style="height:32px; width:32px" /></button>
			<button id="changeColorToWhitePurple"><img src="{{ url_for('static', filename='images/brush2.png') }}" style="height:32px; width:32px" /></button>
			<button id="changeColorToWhiteYellow"><img src="{{ url_for('static', filename='images/brush4.png') }}" style="height:32px; width:32px" /></button>
			<button id="changeColorToWhitePink"><img src="{{ url_for('static', filename='images/brush1.png') }}" style="height:32px; width:32px" /></button>
			<!-- placeholders -->
			<button id=""><img src="{{ url_for('static', filename='images/brush1.png') }}" style="height:32px; width:32px" /></button>
			<button id=""><img src="{{ url_for('static', filename='images/brush1.png') }}" style="height:32px; width:32px" /></button>
			<button id=""><img src="{{ url_for('static', filename='images/brush1.png') }}" style="height:32px; width:32px" /></button>
			<button id=""><img src="{{ url_for('static', filename='images/brush1.png') }}" style="height:32px; width:32px" /></button>
			<button id=""><img src="{{ url_for('static', filename='images/brush1.png') }}" style="height:32px; width:32px" /></button>
			<button id=""><img src="{{ url_for('static', filename='images/brush1.png') }}" style="height:32px; width:32px" /></button>
			<button id=""><img src="{{ url_for('static', filename='images/brush1.png') }}" style="height:32px; width:32px" /></button>
			<button id=""><img src="{{ url_for('static', filename='images/brush1.png') }}" style="height:32px; width:32px" /></button>
			<button id=""><img src="{{ url_for('static', filename='images/brush1.png') }}" style="height:32px; width:32px" /></button>
		</div>

		
		<h3 style="background-color: #FF987E; text-align: center;"><button><img src="{{ url_for('static', filename='images/navigatorbrush.png') }}" class="icon-inactive"/></button></h3>
		<div style="border: 2px solid #FF987E; background-color:white;">
			<button id="changeToolToBrush"><img  src="{{ url_for('static', filename='images/brush.png') }}" style="height:32px; width:32px;" /></button>
			<button id="changeToolToBrush2"><img  src="{{ url_for('static', filename='images/2.png') }}" style="height:32px; width:32px;"/></button>
			<button id="changeToolToBrush3"><img  src="{{ url_for('static', filename='images/3.png') }}" style="height:32px; width:32px;"/></button>
			<!-- these are placeholders -->
			<button id=""><img  src="{{ url_for('static', filename='images/brush.png') }}" style="height:32px; width:32px;" /></button>
			<button id=""><img  src="{{ url_for('static', filename='images/brush.png') }}" style="height:32px; width:32px;" /></button>
			<button id=""><img  src="{{ url_for('static', filename='images/brush.png') }}" style="height:32px; width:32px;" /></button>
			<button id=""><img  src="{{ url_for('static', filename='images/brush.png') }}" style="height:32px; width:32px;" /></button>
			<button id=""><img  src="{{ url_for('static', filename='images/brush.png') }}" style="height:32px; width:32px;" /></button>
			<button id=""><img  src="{{ url_for('static', filename='images/brush.png') }}" style="height:32px; width:32px;" /></button>
			<button id=""><img  src="{{ url_for('static', filename='images/brush.png') }}" style="height:32px; width:32px;" /></button>
			<button id=""><img  src="{{ url_for('static', filename='images/brush.png') }}" style="height:32px; width:32px;" /></button>
			<button id=""><img  src="{{ url_for('static', filename='images/brush.png') }}" style="height:32px; width:32px;" /></button>
			<button id=""><img  src="{{ url_for('static', filename='images/brush.png') }}" style="height:32px; width:32px;" /></button>
			<button id=""><img  src="{{ url_for('static', filename='images/brush.png') }}" style="height:32px; width:32px;" /></button>
			<button id=""><img  src="{{ url_for('static', filename='images/brush.png') }}" style="height:32px; width:32px;" /></button>
			<button id=""><img  src="{{ url_for('static', filename='images/brush.png') }}" style="height:32px; width:32px;" /></button>
		</div>

		
		<h3 style="background-color: #FFCC99; text-align: center;"><button><img src="{{ url_for('static', filename='images/navigatorstamp.png') }}" class="icon-inactive"/></button></h3>
		<div style="border: 2px solid #FFCC99; background-color:white;">
			<button id="changeStamp2"><img  src="{{ url_for('static', filename='images/2.png') }}" style="height:32px; width:32px;"/></button>
			<button id="changeStamp3"><img  src="{{ url_for('static', filename='images/3.png') }}" style="height:32px; width:32px;"/></button>
			<button id="changeStamp4"><img  src="{{ url_for('static', filename='images/jd2.png') }}" style="height:32px; width:32px;"/></button>
			<!-- these are placeholders -->
			<button id=""><img  src="{{ url_for('static', filename='images/2.png') }}" style="height:32px; width:32px;"/></button>
			<button id=""><img  src="{{ url_for('static', filename='images/2.png') }}" style="height:32px; width:32px;"/></button>
			<button id=""><img  src="{{ url_for('static', filename='images/2.png') }}" style="height:32px; width:32px;"/></button>
			<button id=""><img  src="{{ url_for('static', filename='images/2.png') }}" style="height:32px; width:32px;"/></button>
			<button id=""><img  src="{{ url_for('static', filename='images/2.png') }}" style="height:32px; width:32px;"/></button>
			<button id=""><img  src="{{ url_for('static', filename='images/2.png') }}" style="height:32px; width:32px;"/></button>
			<button id=""><img  src="{{ url_for('static', filename='images/2.png') }}" style="height:32px; width:32px;"/></button>
			<button id=""><img  src="{{ url_for('static', filename='images/2.png') }}" style="height:32px; width:32px;"/></button>
			<button id=""><img  src="{{ url_for('static', filename='images/2.png') }}" style="height:32px; width:32px;"/></button>
			<button id=""><img  src="{{ url_for('static', filename='images/2.png') }}" style="height:32px; width:32px;"/></button>
			<button id=""><img  src="{{ url_for('static', filename='images/2.png') }}" style="height:32px; width:32px;"/></button>
			<button id=""><img  src="{{ url_for('static', filename='images/2.png') }}" style="height:32px; width:32px;"/></button>
			<button id=""><img  src="{{ url_for('static', filename='images/2.png') }}" style="height:32px; width:32px;"/></button>
		</div>
	</div>
</div>


<script>

//we need to do a document onload thing here. will get images from the server
//should create buttons with image elements. (like the pikachus above)
//should select the first one.
//later, also need functions to change selected image.




//canvas stuff



var imageObj = new Image();
imageObj.src = "{{ filename }}";
console.log(imageObj);

var el;
var ctx;
var background;
var backgroundctx;



imageObj.onload = function() {
        console.log(imageObj.width);
		console.log(imageObj.height);

		var width = imageObj.width;
		var height = imageObj.height;

		if (width > 700) {
			width = 700;
			//height is scaled
		}

		if (height > 494) {
			height = 494;
			//width is scaled
		}

		el = document.getElementById('c');
		el.width = imageObj.width;
		el.height = imageObj.height;
		ctx = el.getContext('2d');

		background = document.getElementById('photo');
		background.width = imageObj.width;
		background.height = imageObj.height;
		backgroundctx = background.getContext('2d');

        backgroundctx.drawImage(imageObj, 0, 0);

        setUpCanvas();
      };
//imageObj.src = '{{ url_for('static', filename=filename) }}';





//colors
var colorPurple = "#cb3594";
var colorGreen = "#659b41";
var colorYellow = "#ffcf33";
var colorBrown = "#986928";

//marker sizes
var markerSmall = 2;
var markerMedium = 5;
var markerLarge = 10;
var markerXlarge = 15;

//brush sizes
var brushSmall = 32;
var brushMedium = 50;
var brushLarge = 75;
var brushXlarge = 100;

//stamp sizes are same as brush sizes
var stampSmall = brushSmall;
var stampMedium = brushMedium;
var stampLarge = brushLarge;
var stampXlarge = brushXlarge;


//active elements
var activeSizeElement = document.getElementById("changeSizeToMedium");
var activeBrushOrStampElement = document.getElementById("changeColorToPurple");

activeBrushOrStampElement.className = "button-active";
activeSizeElement.className = "button-active";
var activeMarkerSize = markerMedium;
var activeBrushSize = brushMedium;
var activeStampSize = stampMedium;
var activeTool = "marker";

//reset the canvas
document.getElementById("clear").addEventListener('click', function(){
	el.width = el.width;
	clearCanvas();
	document.getElementById("ui-id-1").click();
});

//changes color
document.getElementById("changeToolToEraser").addEventListener('click', function(){
	ctx.globalCompositeOperation = "destination-out";
	activeTool = "marker";
	updateCursor("eraser");
	drawWithMarker("purple", "purple");
	updateActiveBrushOrStampElement(document.getElementById("changeToolToEraser"));
});
document.getElementById("changeColorToPurple").addEventListener('click', function(){
	ctx.globalCompositeOperation = "source-over";
	activeTool = "marker";
	updateCursor("marker");
	drawWithMarker("purple", "purple");
	updateActiveBrushOrStampElement(document.getElementById("changeColorToPurple"));
	//you need to highlight the last size you used with a brush

	//marker size stuff - to make sure you show the last selected size per
	if (activeMarkerSize == markerSmall) {
		updateActiveSizeElement(document.getElementById("changeSizeToSmall"));
	} else if (activeMarkerSize == markerMedium) {
		updateActiveSizeElement(document.getElementById("changeSizeToMedium"));
	} else if (activeMarkerSize == markerLarge) {
		updateActiveSizeElement(document.getElementById("changeSizeToLarge"));
	} else {
		updateActiveSizeElement(document.getElementById("changeSizeToXLarge"));
	}
});
document.getElementById("changeColorToGreen").addEventListener('click', function(){
	ctx.globalCompositeOperation = "source-over";
	activeTool = "marker";
	updateCursor("marker");
	drawWithMarker("green", "green");
	updateActiveBrushOrStampElement(document.getElementById("changeColorToGreen"));

	//markerSize stuff
	if (activeMarkerSize == markerSmall) {
		updateActiveSizeElement(document.getElementById("changeSizeToSmall"));
	} else if (activeMarkerSize == markerMedium) {
		updateActiveSizeElement(document.getElementById("changeSizeToMedium"));
	} else if (activeMarkerSize == markerLarge) {
		updateActiveSizeElement(document.getElementById("changeSizeToLarge"));
	} else {
		updateActiveSizeElement(document.getElementById("changeSizeToXLarge"));
	}
});
document.getElementById("changeColorToYellow").addEventListener('click', function(){
	ctx.globalCompositeOperation = "source-over";
	activeTool = "marker";
	updateCursor("marker");
	drawWithMarker("yellow", "yellow");
	updateActiveBrushOrStampElement(document.getElementById("changeColorToYellow"));

	//markerSize stuff
	if (activeMarkerSize == markerSmall) {
		updateActiveSizeElement(document.getElementById("changeSizeToSmall"));
	} else if (activeMarkerSize == markerMedium) {
		updateActiveSizeElement(document.getElementById("changeSizeToMedium"));
	} else if (activeMarkerSize == markerLarge) {
		updateActiveSizeElement(document.getElementById("changeSizeToLarge"));
	} else {
		updateActiveSizeElement(document.getElementById("changeSizeToXLarge"));
	}
});
document.getElementById("changeColorToPink").addEventListener('click', function(){
	ctx.globalCompositeOperation = "source-over";
	activeTool = "marker";
	updateCursor("marker");
	drawWithMarker("pink", "pink");
	updateActiveBrushOrStampElement(document.getElementById("changeColorToPink"));

	//markerSize stuff
	if (activeMarkerSize == markerSmall) {
		updateActiveSizeElement(document.getElementById("changeSizeToSmall"));
	} else if (activeMarkerSize == markerMedium) {
		updateActiveSizeElement(document.getElementById("changeSizeToMedium"));
	} else if (activeMarkerSize == markerLarge) {
		updateActiveSizeElement(document.getElementById("changeSizeToLarge"));
	} else {
		updateActiveSizeElement(document.getElementById("changeSizeToXLarge"));
	}
});
document.getElementById("changeColorToWhitePurple").addEventListener('click', function(){
	ctx.globalCompositeOperation = "source-over";
	activeTool = "marker";
	updateCursor("marker");
	drawWithMarker("white", "purple");
	updateActiveBrushOrStampElement(document.getElementById("changeColorToWhitePurple"));

	//markerSize stuff
	if (activeMarkerSize == markerSmall) {
		updateActiveSizeElement(document.getElementById("changeSizeToSmall"));
	} else if (activeMarkerSize == markerMedium) {
		updateActiveSizeElement(document.getElementById("changeSizeToMedium"));
	} else if (activeMarkerSize == markerLarge) {
		updateActiveSizeElement(document.getElementById("changeSizeToLarge"));
	} else {
		updateActiveSizeElement(document.getElementById("changeSizeToXLarge"));
	}
});
document.getElementById("changeColorToWhiteYellow").addEventListener('click', function(){
	ctx.globalCompositeOperation = "source-over";
	activeTool = "marker";
	updateCursor("marker");
	drawWithMarker("white", "yellow");
	updateActiveBrushOrStampElement(document.getElementById("changeColorToWhiteYellow"));

	//markerSize stuff
	if (activeMarkerSize == markerSmall) {
		updateActiveSizeElement(document.getElementById("changeSizeToSmall"));
	} else if (activeMarkerSize == markerMedium) {
		updateActiveSizeElement(document.getElementById("changeSizeToMedium"));
	} else if (activeMarkerSize == markerLarge) {
		updateActiveSizeElement(document.getElementById("changeSizeToLarge"));
	} else {
		updateActiveSizeElement(document.getElementById("changeSizeToXLarge"));
	}
});
document.getElementById("changeColorToWhitePink").addEventListener('click', function(){
	ctx.globalCompositeOperation = "source-over";
	activeTool = "marker";
	updateCursor("marker");
	drawWithMarker("white", "pink");
	updateActiveBrushOrStampElement(document.getElementById("changeColorToWhitePink"));

	//markerSize stuff
	if (activeMarkerSize == markerSmall) {
		updateActiveSizeElement(document.getElementById("changeSizeToSmall"));
	} else if (activeMarkerSize == markerMedium) {
		updateActiveSizeElement(document.getElementById("changeSizeToMedium"));
	} else if (activeMarkerSize == markerLarge) {
		updateActiveSizeElement(document.getElementById("changeSizeToLarge"));
	} else {
		updateActiveSizeElement(document.getElementById("changeSizeToXLarge"));
	}
});



//BRUSHES!

//I think this is gross. What's up with the double call to getElementById?
document.getElementById("changeToolToBrush").addEventListener('click', function(){
	ctx.globalCompositeOperation = "source-over";
	activeTool = "brush";
	updateCursor("brush");
	//console.log("active brush size feeding into fn: ", activeBrushSize);
	drawWithBrush(document.getElementById("changeToolToBrush").childNodes[0].src);
	updateActiveBrushOrStampElement(document.getElementById("changeToolToBrush"));

	//brushSize stuff
	if (activeBrushSize == brushSmall) {
		updateActiveSizeElement(document.getElementById("changeSizeToSmall"));
	} else if (activeBrushSize == brushMedium) {
		updateActiveSizeElement(document.getElementById("changeSizeToMedium"));
	} else if (activeBrushSize == brushLarge) {
		updateActiveSizeElement(document.getElementById("changeSizeToLarge"));
	} else {
		updateActiveSizeElement(document.getElementById("changeSizeToXLarge"));
	}
});

document.getElementById("changeToolToBrush2").addEventListener('click', function(){
	ctx.globalCompositeOperation = "source-over";
	activeTool = "brush";
	updateCursor("brush");
	drawWithBrush(document.getElementById("changeToolToBrush2").childNodes[0].src);
	updateActiveBrushOrStampElement(document.getElementById("changeToolToBrush2"));

	//brushSize stuff
	if (activeBrushSize == brushSmall) {
		updateActiveSizeElement(document.getElementById("changeSizeToSmall"));
	} else if (activeBrushSize == brushMedium) {
		updateActiveSizeElement(document.getElementById("changeSizeToMedium"));
	} else if (activeBrushSize == brushLarge) {
		updateActiveSizeElement(document.getElementById("changeSizeToLarge"));
	} else {
		updateActiveSizeElement(document.getElementById("changeSizeToXLarge"));
	}
});

document.getElementById("changeToolToBrush3").addEventListener('click', function(){
	ctx.globalCompositeOperation = "source-over";
	activeTool = "brush";
	updateCursor("brush");

	drawWithBrush(document.getElementById("changeToolToBrush3").childNodes[0].src);
	updateActiveBrushOrStampElement(document.getElementById("changeToolToBrush3"));

	//brushSize stuff
	if (activeBrushSize == brushSmall) {
		updateActiveSizeElement(document.getElementById("changeSizeToSmall"));
	} else if (activeBrushSize == brushMedium) {
		updateActiveSizeElement(document.getElementById("changeSizeToMedium"));
	} else if (activeBrushSize == brushLarge) {
		updateActiveSizeElement(document.getElementById("changeSizeToLarge"));
	} else {
		updateActiveSizeElement(document.getElementById("changeSizeToXLarge"));
	}
});

//changes stamps
//again, super gross with the double call
document.getElementById("changeStamp2").addEventListener('click', function() {
	ctx.globalCompositeOperation = "source-over";
	activeTool = "stamp";
	updateCursor("stamp");
	drawStamp(document.getElementById("changeStamp2").childNodes[0].src);
	updateActiveBrushOrStampElement(document.getElementById("changeStamp2"));

	//stampSize stuff
	if (activeStampSize == stampSmall) {
		updateActiveSizeElement(document.getElementById("changeSizeToSmall"));
	} else if (activeStampSize == stampMedium) {
		updateActiveSizeElement(document.getElementById("changeSizeToMedium"));
	} else if (activeStampSize == stampLarge) {
		updateActiveSizeElement(document.getElementById("changeSizeToLarge"));
	} else {
		updateActiveSizeElement(document.getElementById("changeSizeToXLarge"));
	}
});
document.getElementById("changeStamp3").addEventListener('click', function() {
	ctx.globalCompositeOperation = "source-over";
	activeTool = "stamp";
	updateCursor("stamp");
	drawStamp(document.getElementById("changeStamp3").childNodes[0].src);
	updateActiveBrushOrStampElement(document.getElementById("changeStamp3"));

	//stampSize stuff
	if (activeStampSize == stampSmall) {
		updateActiveSizeElement(document.getElementById("changeSizeToSmall"));
	} else if (activeStampSize == stampMedium) {
		updateActiveSizeElement(document.getElementById("changeSizeToMedium"));
	} else if (activeStampSize == stampLarge) {
		updateActiveSizeElement(document.getElementById("changeSizeToLarge"));
	} else {
		updateActiveSizeElement(document.getElementById("changeSizeToXLarge"));
	}
});
document.getElementById("changeStamp4").addEventListener('click', function() {
	ctx.globalCompositeOperation = "source-over";
	activeTool = "stamp";
	updateCursor("stamp");
	drawStamp(document.getElementById("changeStamp4").childNodes[0].src);
	updateActiveBrushOrStampElement(document.getElementById("changeStamp4"));

	//stampSize stuff
	if (activeStampSize == stampSmall) {
		updateActiveSizeElement(document.getElementById("changeSizeToSmall"));
	} else if (activeStampSize == stampMedium) {
		updateActiveSizeElement(document.getElementById("changeSizeToMedium"));
	} else if (activeStampSize == stampLarge) {
		updateActiveSizeElement(document.getElementById("changeSizeToLarge"));
	} else {
		updateActiveSizeElement(document.getElementById("changeSizeToXLarge"));
	}
});


//changes size
//I think the activesizeelement is ok...you just need something like "if it's a merker..."

document.getElementById("changeSizeToSmall").addEventListener('click', function(){
	if (activeTool == "marker") {
		ctx.lineWidth = markerSmall;
		ctx.shadowBlur = markerSmall;
		activeMarkerSize = markerSmall;
	} else if (activeTool == "brush") {
		activeBrushSize = brushSmall;
		//console.log("changing brush size to small: ", activeBrushSize);
	} else {
		activeStampSize = stampSmall;
	}
	
	updateActiveSizeElement(document.getElementById("changeSizeToSmall"));
});
document.getElementById("changeSizeToMedium").addEventListener('click', function(){
	if (activeTool == "marker") {
		ctx.lineWidth = markerMedium;
		ctx.shadowBlur = markerMedium;
		activeMarkerSize = markerMedium;
	} else if (activeTool == "brush") {
		activeBrushSize = brushMedium;
	} else {
		activeStampSize = stampMedium;
	}
	
	updateActiveSizeElement(document.getElementById("changeSizeToMedium"));
});
document.getElementById("changeSizeToLarge").addEventListener('click', function(){
	if (activeTool == "marker") {
		ctx.lineWidth = markerLarge;
		ctx.shadowBlur = markerLarge;
		activeMarkerSize = markerLarge;
	} else if (activeTool == "brush") {
		activeBrushSize = brushLarge;
	} else {
		activeStampSize = stampLarge;
	}
	
	updateActiveSizeElement(document.getElementById("changeSizeToLarge"));
});
document.getElementById("changeSizeToXLarge").addEventListener('click', function(){
	if (activeTool == "marker") {
		ctx.lineWidth = markerXlarge;
		ctx.shadowBlur = markerXlarge;
		activeMarkerSize = markerXlarge;
	} else if (activeTool == "brush") {
		activeBrushSize = brushXlarge;
	} else {
		activeStampSize = stampXlarge;
	}

	updateActiveSizeElement(document.getElementById("changeSizeToXLarge"));
});

function clearCanvas() {
	//the sizes of the marker stuff will be taken care of by the clicks.
	//you still need to update the sizes of the other tools.

	activeBrushSize = brushMedium;
	activeStampSize = stampMedium;
	document.getElementById("changeColorToPurple").click();
	document.getElementById("changeSizeToMedium").click();
}

function setUpCanvas() {
	//this function will be expanded later? maybe?
	//ctx.strokeRect(0,0,el.width, el.height);
	ctx.lineWidth = 5; //tried putting medium here. didn't like it
	ctx.shadowBlur = 5;
	ctx.lineJoin = ctx.lineCap = 'round';

	activeSizeElement = document.getElementById("changeSizeToMedium");
	activeBrushOrStampElement = document.getElementById("changeColorToPurple");

	activeBrushOrStampElement.className = "button-active";
	activeSizeElement.className = "button-active";
	activeMarkerSize = markerMedium;
	activeBrushSize = brushMedium;
	activeStampSize = stampMedium;
	activeTool = "marker";

	updateCursor("marker");
	drawWithMarker("purple", "purple");


	//I originally wanted to put the update functions in the onload...
	//updateActiveSizeElement(activeSizeElement);
	//updateActiveBrushOrStampElement(activeBrushOrStampElement);

};

function updateCursor(type) {
	if (type == "brush") {
		document.getElementById("c").className = "cursor-brush";
	} else if (type == "stamp") {
		document.getElementById("c").className = "cursor-stamp";
	} else if (type == "marker") {
		document.getElementById("c").className = "cursor-marker";
	} else {
		document.getElementById("c").className = "cursor-eraser";
	}
};

function updateActiveSizeElement(newElement) {
	activeSizeElement.className = "";
	newElement.className = "button-active";
	activeSizeElement = newElement;
	activeSizeElement.blur(); //I don't want focus showing up b/c you have multiple things selected
};

function updateActiveBrushOrStampElement(newElement) {
	//console.log(newElement);

	//all this logic is to make sure the header is lighted/dimmed when selecting the eraser
	if (newElement == document.getElementById("changeToolToEraser")) {
		var headerToBeUpdated = document.getElementById("accordion").childNodes;
		for (var i = 1; i< headerToBeUpdated.length; i += 4) {
			//console.log(i, headerToBeUpdated[i]);
			 if (headerToBeUpdated[i].classList.contains("ui-state-active")) {
				var buttonToBeUpdated = headerToBeUpdated[i].childNodes[1];
				//console.log(buttonToBeUpdated);
				buttonToBeUpdated.classList.add("accordion-button-adjustment");
			}
		}
	} else {
		var headerToBeUpdated = document.getElementById("accordion").childNodes;
		//console.log(headerToBeUpdated);
		for (var i = 1; i< headerToBeUpdated.length; i += 4) {
			//console.log(i, headerToBeUpdated[i]);
			 if (headerToBeUpdated[i].classList.contains("ui-state-active")) {
				var buttonToBeUpdated = headerToBeUpdated[i].childNodes[1];
				//console.log(buttonToBeUpdated);
				buttonToBeUpdated.classList.remove("accordion-button-adjustment");
			}
		}
	}
	activeBrushOrStampElement.className = "";
	newElement.className = "button-active";
	activeBrushOrStampElement = newElement;
	activeBrushOrStampElement.blur(); //I don't want focus showing up b/c you have multiple things selected
};

function drawStamp(src) {
	var img = new Image();
	img.src = src;

	el.onmousedown = function(e) {
		//the minuses are offsets
		ctx.drawImage(img, e.pageX-200, e.pageY-200, activeStampSize, activeStampSize); //200s for offset
	};
};

//MAKE A SPACING PARAMETER. EVERY BRUSH HAS DIFFERENT SPACING!!!

function drawWithBrush(src) {
	var img = new Image();
	img.src = src;

	function distanceBetween(point1, point2) {
		return Math.sqrt(Math.pow(point2.x - point1.x, 2) + Math.pow(point2.y - point1.y, 2));
	};
	function angleBetween(point1, point2) {
		return Math.atan2( point2.x - point1.x, point2.y - point1.y );
	};
	
	ctx.lineJoin = ctx.lineCap = 'round';

	var isDrawing, lastPoint;

	el.onmousedown = function(e) {
		//console.log("here?");
		isDrawing = true;
		lastPoint = { x: e.pageX-160, y: e.pageY-160}; //changed clientX to pageX. 160s for offset

		//make sure there's no shadow, in case you used the marker
		ctx.shadowBlur = 0;
	};

	//

	el.onmousemove = function(e) {
		if (!isDrawing) return;

		var currentPoint = { x: e.pageX-160, y: e.pageY-160}; //changed clientX to pageX
		var dist = distanceBetween(lastPoint, currentPoint);
		var angle = angleBetween(lastPoint, currentPoint);

		for (var i = 0; i < dist; i+= 75) {
			x = lastPoint.x + (Math.sin(angle) * i) - 25;
			y = lastPoint.y + (Math.cos(angle) * i) - 25;
			ctx.drawImage(img, x, y, activeBrushSize, activeBrushSize); //the 32's are FOR SCALING!
		}

		lastPoint = currentPoint;
	};

	el.onmouseup = function() {
		isDrawing = false;
	};

};


function drawWithMarker(color, shadowColor) {

	var isDrawing;


	el.onmousedown = function(e) {
	  isDrawing = true;
	  //moving to onload
	  
	  // ctx.lineJoin = ctx.lineCap = 'round';
	  ctx.moveTo(e.pageX-180, e.pageY-180); //changed clientX to pageX 180s for offset
	  ctx.beginPath();
	};
	el.onmousemove = function(e) {
	  if (isDrawing) {
	    ctx.strokeStyle = color;
	    ctx.shadowColor = shadowColor;
	    ctx.lineWidth = activeMarkerSize; //have to set these again because they dont show up after the brush..not sure why
		ctx.shadowBlur = ctx.lineWidth; //orignally set this to "activeSize" but it didn't like it?
		// console.log("linewidth", ctx.lineWidth);
		// console.log("shadow", ctx.shadowBlur);



	    //THIS WORKS FINE IF THE TOOL BFORE YOU IS A MARKER. NOT OK IF ITS A BRUSH
	    //(LOOKS LIKE NO SETTINGS IF AFTER BRUSH). OK if you select a size fn.
	    //FIGURE OUT WHATS UP

	    ctx.lineTo(e.pageX-180, e.pageY-165); //the minuses are for offsets. //changed clientX to pageX
	    ctx.stroke();
	  }
	};
	el.onmouseup = function() {
	  isDrawing = false;
	};
};

//for saving image
document.getElementById('save').addEventListener('click', function(){
	//should send dataurls for processing.
	//console.log("clicked save button");

	//doing some of the same processing as download to gt the uri.

	//you can't edit the canvases you have, so create a new one.
	var copyForDownloading = document.createElement('canvas');
	var ctxCopyForDownloading = copyForDownloading.getContext('2d');
	ctxCopyForDownloading.canvas.width = document.getElementById("photo").width;
	ctxCopyForDownloading.canvas.height = document.getElementById("photo").height;

	//copy the working canvases onto the canvas to be downloaded
	ctxCopyForDownloading.drawImage(document.getElementById("photo"), 0, 0);
	ctxCopyForDownloading.drawImage(document.getElementById("c"), 0, 0);

	$.ajax({
		type: "POST",
		url: "{{ url_for('update_purikura') }}",
		data: { filename: '{{ filename }}', updated_src: copyForDownloading.toDataURL('image/jpeg', 1.0) },
		success: function(response) {
			//console.log(response);
		},
		error: function(error) {
			//console.log(error)
		}

	});
});


//for downloading image

document.getElementById('download').addEventListener('click', function(){
	//you can't edit the canvases you have, so create a new one.
	var copyForDownloading = document.createElement('canvas');
	var ctxCopyForDownloading = copyForDownloading.getContext('2d');
	ctxCopyForDownloading.canvas.width = document.getElementById("photo").width;
	ctxCopyForDownloading.canvas.height = document.getElementById("photo").height;

	//copy the working canvases onto the canvas to be downloaded
	ctxCopyForDownloading.drawImage(document.getElementById("photo"), 0, 0);
	ctxCopyForDownloading.drawImage(document.getElementById("c"), 0, 0);

	//set up the download information
	this.href = copyForDownloading.toDataURL();
	this.download = 'purikura.jpeg';
});


</script>







{% endblock %}