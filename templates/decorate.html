{% extends "layout.html" %}

{% block header %}

	<link rel="stylesheet" href="{{ url_for('static', filename='css/main.css')}}">
	<script language="javascript" type="text/javascript" src="{{ url_for('static', filename='js/jquery-1.11.0.min.js')}}"></script>
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='bootstrap/css/bootstrap.css') }}">
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='bootstrap/css/bootstrap-theme.css') }}">
	<script type="text/javascript" src="{{ url_for('static', filename='bootstrap/js/bootstrap.min.js') }}"></script>

	<!-- for the email form -->
	<script src="http://malsup.github.com/jquery.form.js"></script> 

	<!-- for the accordion stuff -->
	<link rel="stylesheet" href="{{ url_for('static', filename='jqueryui/jquery-ui.css') }}">
	<script type="text/javascript" src="{{ url_for('static', filename='jqueryui/jquery-ui.js') }}"></script>
	<script type="text/javascript" src="{{ url_for('static', filename='js/bootstrap-tooltip.js') }}"></script>
	<script>
	$(function() {
		$( "#accordion" ).accordion({
			heightStyle:"fill"
		});
	});
	</script>

	<!-- random styles for this particular page. will be put into a css file later -->
	<style>

		body {
			background-color: #171717;
			margin:0px;
		}
	/* for gallery */
		.gallery {
			display: block;
			text-align: center;
			position: relative;
			padding: .7em .7em .7em .7em;
			min-height: 0;
			font-size: 100%;
			background: #470024;
			border-top: 10px solid black;
		}
		.gallery > img {
			-webkit-filter: opacity(0.4);
		}

		.gallery >img:hover {
			-webkit-filter: opacity(1);
		}
		.gallery-img-active {
			-webkit-filter: opacity(1);
		}

	/* for accordion */
		h3 > img {
			-webkit-filter: invert(1);
		}
		.h3-faux-accordion {
			display: block;
			text-align: center;
			position: relative;
			margin: 2px 0 0 0;
			padding: .5em .5em .5em .7em;
			min-height: 0;
			font-size: 100%;
			height: 48px;
		}

		.form-group {
			text-align: left;
		}

		#emailNote {
			text-align: left;
			font-size: 13px;
			color: #FF0000;
		}

	/* for accordion icons and tool selection */
		button {
			border: none;
			background: none;
			-webkit-filter: opacity(0.4);
		}

		button:hover {
			-webkit-filter: opacity(1);
		}

		button:focus {
			outline: 0 !important;
		}
		.accordion-button-adjustment {
			-webkit-filter: opacity(0.4) !important;
		}

		.icon-inactive {
			display:inline-block; 
			-webkit-filter: invert(1);
		}

		.button-active {
			border: none;
			background: none;
			-webkit-filter: none;
		}

	/* for editor cursors */

		.cursor-marker {
			cursor: url("{{ url_for('static', filename='images/cursormarker.png') }}" ), auto;
		}

		.cursor-brush {
			cursor: url( "{{ url_for('static', filename='images/cursorbrush.png') }}" ), auto;
		}

		.cursor-stamp {
			cursor: url( "{{ url_for('static', filename='images/cursorstamp.png') }}" ), auto;
		}

		.cursor-eraser {
			cursor: url( "{{ url_for('static', filename='images/cursoreraser.png') }}" ), auto;
		}

	</style>

{% endblock %}

{% block content %}

<div class="col-md-9">
	<div style="position: relative;">
		<!-- the javascript gets really jacked up if you move this.
		probably b/c of the mouse placement offset. will look into later. -->

		<!-- 494px height to match with sidebar -->
		<canvas id="photo" width="700" height="494" style="left: 0; top: 0; z-index:0; margin-left:42px; margin-top:127px;"></canvas>
		<canvas id="c" width="700" height="494" style="position: absolute; left: 0; top: 0; z-index:1; margin-left:42px; margin-top:127px;"></canvas>
		<!-- <img src="{{ filename }}" /> -->
	</div>
</div>

<div class="col-md-3" style="position:absolute; right:0; height:700px; margin-right: 10px;">
	<div>
		<!-- margin 0px just for this guy b/c want top plumb with editor window -->
		<h3 class="h3-faux-accordion" style="background-color: #660033; margin:0px;">
			
			<!-- Save function -->
			<button data-toggle="modal" data-target="#saveModal"><a id="save"><img src="{{ url_for('static', filename='images/navigatorsave.png') }}" style="height:32px; width:32px;" class="icon-inactive"/></a></button>

			<!-- Save function popup -->
			<div class="modal fade" id="saveModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			  <div class="modal-dialog">
			    <div class="modal-content">
			      <div class="modal-header">
			        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
			        <h4 class="modal-title" id="myModalLabel">Saved in Gallery!</h4>
			      </div>
			      <div class="modal-body">
			      	<p>Click <a href="{{ url_for('main') }}">here</a> to see it!</p>  
			      </div>
			    </div>
			  </div>
			</div>

			<button><a id="download"><img src="{{ url_for('static', filename='images/navigatordownload.png') }}" style="height:32px; width:32px;" class="icon-inactive"/></a></button>

			<!-- Email function -->
			<button data-toggle="modal" data-target="#emailModal"><a id="email"><img src="{{ url_for('static', filename='images/email.png') }}" style="height:26px; width:32px;" class="icon-inactive"/></a></button>


			<!-- Email function popup -->
			<div class="modal" id="emailModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			  <div class="modal-dialog">
			    <div class="modal-content">
			      <div class="modal-header">
			        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
			        <h4 class="modal-title" id="myModalLabel">Send Image</h4>
			      </div>
			      <div class="modal-body">
			        <form id="emailImage">
			        	<div class="form-group">
			              <label for="email">Email addresses:</label>
			              <p id="emailNote">Please enter email addresses separated by commas.</p>
			              <input type="text" name="address" class="form-control" placeholder="example@example.com, example2@example.com" required autofocus name="email"/>

			              <br />
			              <label for="subject">Email subject:</label>
			              <input type="text" name="subject" class="form-control" placeholder="Subject..." required autofocus name="subject"/>

			              <br />
			              <label for="subject">Email body:</label>
			              <textarea class="form-control" rows="3" placeholder="Body..." name="body"></textarea>
			              <!-- <input type="text" name="body" class="form-control" placeholder="Message..." required autofocus name="body"/> -->

			              <input type="hidden" name="filename" value=" {{ filename }} " />
			              <!-- <input class="btn btn-primary" type="submit" value="Submit" /> -->
						  <br />
			              <input class="btn btn-primary" type="submit" id="submitButton" value="Send email" />
			            </div>
<!-- 			            <input type="submit" value="submit" />
	<button type="submit" class="btn btn-primary">Upload</button>
 -->			    </form>
			      </div>
			      <!-- <div class="modal-footer">
			        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			      </div> -->
			    </div>
			  </div>
			</div>

		</h3>
	</div>

	<div>
		<div>
			<h3 class="h3-faux-accordion" style="background-color: #8A002E;">
				<button id="changeToolToEraser"><img src="{{ url_for('static', filename='images/navigatoreraser.png') }}" style="height:32px; width:32px" class="icon-inactive"/></button>
				<button id="clear"><img src="{{ url_for('static', filename='images/navigatorreload.png') }}" style="height:32px; width:32px" class="icon-inactive"/></button>
			</h3>
		</div>

		<div>
			<h3 class="h3-faux-accordion" style="background-color: #B8005C;">

				<!-- sizes should be universal. sticking outside for now. still need to implement sizing for brush and stamps -->
				<button id="changeSizeToSmall" data-toggle="tooltip" data-placement="top" title="Change tool size to small"><img src="{{ url_for('static', filename='images/sizesmall.png') }}" style="height:32px; width: 32px" class="icon-inactive"/></button>
				<button id="changeSizeToMedium"><img src="{{ url_for('static', filename='images/sizemedium.png') }}" style="height:32px; width: 32px" class="icon-inactive"/></button>
				<button id="changeSizeToLarge"><img src="{{ url_for('static', filename='images/sizelarge.png') }}" style="height:32px; width: 32px" class="icon-inactive"/></button>
				<button id="changeSizeToXLarge"><img src="{{ url_for('static', filename='images/sizexlarge.png') }}" style="height:32px; width: 32px" class="icon-inactive"/></button>
			</h3>
		</div>

	</div>
	<!-- trying to make accordion height same as editor window. will deal with once window size finalized -->

	<!-- we will also have to set the width of this so it's not dynamic -->
	<div id="accordion">
		<h3 style="background-color: #FF5050; text-align: center;"><button><img src="{{ url_for('static', filename='images/navigatormarker.png') }}" class="icon-inactive"/></button></h3>
		<div style="border: 2px solid #FF5050; background-color:white;">
			<button id="changeColorToPurple"><img src="{{ url_for('static', filename='images/brush2a.png') }}" style="height:32px; width:32px" /></button>
			<button id="changeColorToBlack"><img src="{{ url_for('static', filename='images/brushblack.png') }}" style="height:32px; width:32px;" /></button>
			<button id="changeColorToWhite"><img src="{{ url_for('static', filename='images/brushwhite.png') }}" style="height:32px; width:32px;" /></button>
			<button id="changeColorToGreen"><img src="{{ url_for('static', filename='images/brush3a.png') }}" style="height:32px; width:32px" /></button>
			<button id="changeColorToMint"><img src="{{ url_for('static', filename='images/brushmint.png') }}" style="height:32px; width:32px" /></button>
			<button id="changeColorToRed"><img src ="{{ url_for('static', filename='images/brushred.png') }}" style="height:32px; width:32px;" /></button>
			<button id="changeColorToOrange"><img src="{{ url_for('static', filename='images/brushOrange.png') }}" style="height:32px; width:32px;" /></button>
			<button id="changeColorToYellow"><img src="{{ url_for('static', filename='images/brush4a.png') }}" style="height:32px; width:32px" /></button>
			<button id="changeColorToLightYellow"><img src="{{ url_for('static', filename='images/brushlightyellow.png') }}" style="height:32px; width:32px;" /></button>
			<button id="changeColorToLavender"><img src="{{ url_for('static', filename='images/brushlavender.png') }}" style="height:32px; width:32px" /></button>
			<button id="changeColorToPink"><img src="{{ url_for('static', filename='images/brush1a.png') }}" style="height:32px; width:32px" /></button>
			<button id="changeColorToSkyBlue"><img src="{{ url_for('static', filename='images/brushSkyBlue.png') }}" style="height:32px; width: 32px;" /></button>
			<button id="changeColorToWhitePurple"><img src="{{ url_for('static', filename='images/brush2.png') }}" style="height:32px; width:32px" /></button>
			<button id="changeColorToWhiteBlue"><img src="{{ url_for('static', filename='images/brushbluewhite.png') }}" style="height:32px; width: 32px;" /></button>
			<button id="changeColorToWhiteYellow"><img src="{{ url_for('static', filename='images/brush4.png') }}" style="height:32px; width:32px" /></button>
			<button id="changeColorToWhitePink"><img src="{{ url_for('static', filename='images/brush1.png') }}" style="height:32px; width:32px" /></button>
		</div>
	
		<h3 style="background-color: #FF987E; text-align: center;"><button><img src="{{ url_for('static', filename='images/navigatorbrush.png') }}" class="icon-inactive"/></button></h3>
		<div style="border: 2px solid #FF987E; background-color:white;">
			<button id="changeToolToBrush"><img  src="{{ url_for('static', filename='images/brush.png') }}" style="height:32px; width:32px;" /></button>
			<button id="changeToolToBrush2"><img  src="{{ url_for('static', filename='images/2.png') }}" style="height:32px; width:32px;"/></button>
			<button id="changeToolToBrush3"><img  src="{{ url_for('static', filename='images/3.png') }}" style="height:32px; width:32px;"/></button>
			<button id="changeToolToBlueSparkleBrush"><img src="{{ url_for('static', filename='images/bluesparkle.png') }}" style="height:32px; width:32px;"/></button>
			<button id="changeToolToPinkSparkleBrush"><img  src="{{ url_for('static', filename='images/pinksparkle.png') }}" style="height:32px; width:32px;"/></button>
		</div>
		
		<h3 style="background-color: #FFCC99; text-align: center;"><button><img src="{{ url_for('static', filename='images/navigatorstamp.png') }}" class="icon-inactive"/></button></h3>
		<div style="border: 2px solid #FFCC99; background-color:white;">
			<button id="changeStamp2"><img src="{{ url_for('static', filename='images/2.png') }}" style="height:32px; width:32px;"/></button>
			<button id="changeStamp3"><img src="{{ url_for('static', filename='images/3.png') }}" style="height:32px; width:32px;"/></button>
			<button id="changeStamp4"><img src="{{ url_for('static', filename='images/jd2.png') }}" style="height:32px; width:32px;"/></button>
			<button id="spottedHeartStamp"><img src="{{ url_for('static', filename='images/spottedheart.png') }}" style="height:32px; width:32px;"/></button>
			<button id="pearlHeartStamp"><img src="{{ url_for('static', filename='images/pearlheart.png') }}" style="height:32px; width:32px;"/></button>
			<button id="cherryStamp"><img  src="{{ url_for('static', filename='images/cherries.png') }}" style="height:32px; width:32px;"/></button>
			<button id="crownStamp"><img  src="{{ url_for('static', filename='images/crown.png') }}" style="height:32px; width:32px;"/></button>
			<button id="bowtieStamp"><img  src="{{ url_for('static', filename='images/bowtie.png') }}" style="height:32px; width:32px;"/></button>
			<button id="whiteBowStamp"><img src="{{ url_for('static', filename='images/whitebow.png') }}" style="height:32px; width:32px;"/></button>
			<button id="kittyBowStamp"><img  src="{{ url_for('static', filename='images/kittybow.png') }}" style="height:32px; width:32px;"/></button>
			<button id="diamondStamp"><img  src="{{ url_for('static', filename='images/diamond.png') }}" style="height:32px; width:32px;"/></button>
			<button id="heartDiamondStamp"><img  src="{{ url_for('static', filename='images/heartdiamond.png') }}" style="height:32px; width:32px;"/></button>
			<button id="pinkDiamondStamp"><img  src="{{ url_for('static', filename='images/pinkdiamond.png') }}" style="height:32px; width:32px;"/></button>
			<button id="roseStamp"><img src="{{ url_for('static', filename='images/rose.png') }}" style="height:32px; width:32px;"/></button>
			<button id="daisyStamp"><img src="{{ url_for('static', filename='images/daisy.png') }}" style="height:32px; width:32px;"/></button>
			<button id="pearlStamp"><img src="{{ url_for('static', filename='images/pearl.png') }}" style="height:32px; width:32px;"/></button>
			<button id="pinkCrownStamp"><img src="{{ url_for('static', filename='images/pinkcrown.png') }}" style="height:32px; width:32px;"/></button>
			<button id="blueSparkleStamp"><img src="{{ url_for('static', filename='images/bluesparkle.png') }}" style="height:32px; width:32px;"/></button>
			<button id="pinkSparkleStamp"><img src="{{ url_for('static', filename='images/pinksparkle.png') }}" style="height:32px; width:32px;"/></button>
			<button id="orangeSparkleStamp"><img src="{{ url_for('static', filename='images/orangesparkle.png') }}" style="height:32px; width:32px;"/></button>
			<button id="yellowSparkleStamp"><img src="{{ url_for('static', filename='images/yellowsparkle.png') }}" style="height:32px; width:32px;"/></button>
			<button id="pinkGlassesStamp"><img src="{{ url_for('static', filename='images/pinkGlasses.png') }}" style="height:32px; width:32px;"/></button>
			<button id="glassesStamp"><img src="{{ url_for('static', filename='images/glasses.png') }}" style="height:32px; width:32px;"/></button>
			<button id="stacheStamp"><img src="{{ url_for('static', filename='images/stache.png') }}" style="height:32px; width:32px;"/></button>
			<button id="bearStamp"><img src="{{ url_for('static', filename='images/teddybear.png') }}" style="height:32px; width:32px;"/></button>

		</div>
	</div>
</div>


<script>

//Get the chosen image from the user
var imageObj = new Image();
imageObj.src = "{{ filename }}";

//Declare canvas variables
var el;
var ctx;
var background;
var backgroundctx;

imageObj.onload = function() {

	//Resize image to fit max size of 700x494
	if (imageObj.width > 700) {
		imageObj.height = imageObj.height * (700/imageObj.width); //scale height
		imageObj.width = 700;
	}

	if (imageObj.height > 494) {
		imageObj.width = imageObj.width * (494/imageObj.height); //scale width
		imageObj.height = 494;
	}

	//Copy image onto canvas objects
	el = document.getElementById('c');
	el.width = imageObj.width;
	el.height = imageObj.height;
	ctx = el.getContext('2d');

	background = document.getElementById('photo');
	background.width = imageObj.width;
	background.height = imageObj.height;
	backgroundctx = background.getContext('2d');

    backgroundctx.drawImage(imageObj, 0, 0);

    setUpCanvas();
 };


//Colors
var colorPurple = "#cb3594";
var colorGreen = "#659b41";
var colorYellow = "#ffcf33";
var colorBrown = "#986928";

//Marker sizes
var markerSmall = 2;
var markerMedium = 5;
var markerLarge = 10;
var markerXlarge = 15;

//Brush sizes
var brushSmall = 32;
var brushMedium = 50;
var brushLarge = 75;
var brushXlarge = 100;

//Stamp sizes are same as brush sizes
var stampSmall = brushSmall;
var stampMedium = brushMedium;
var stampLarge = brushLarge;
var stampXlarge = brushXlarge;

//Default active elements
var activeSizeElement = document.getElementById("changeSizeToMedium");
var activeBrushOrStampElement = document.getElementById("changeColorToPurple");

activeBrushOrStampElement.className = "button-active";
activeSizeElement.className = "button-active";
var activeMarkerSize = markerMedium;
var activeBrushSize = brushMedium;
var activeStampSize = stampMedium;
var activeTool = "marker";


/**********************************************************************************
Markers
***********************************************************************************/

document.getElementById("changeToolToEraser").addEventListener('click', function(){
	ctx.globalCompositeOperation = "destination-out";
	activeTool = "marker";
	updateCursor("eraser");
	drawWithMarker("purple", "purple");
	updateActiveBrushOrStampElement(document.getElementById("changeToolToEraser"));
});

document.getElementById("changeColorToPurple").addEventListener('click', function(){
	updateInterface("marker", document.getElementById("changeColorToPurple"));
	drawWithMarker("purple", "purple");
});
document.getElementById("changeColorToGreen").addEventListener('click', function(){
	updateInterface("marker", document.getElementById("changeColorToGreen"));
	drawWithMarker("green", "green");
});
document.getElementById("changeColorToYellow").addEventListener('click', function(){
	updateInterface("marker", document.getElementById("changeColorToYellow"));
	drawWithMarker("yellow", "yellow");
});
document.getElementById("changeColorToPink").addEventListener('click', function(){
	updateInterface("marker", document.getElementById("changeColorToPink"));
	drawWithMarker("pink", "pink");
});
document.getElementById("changeColorToWhitePurple").addEventListener('click', function(){
	updateInterface("marker", document.getElementById("changeColorToWhitePurple"));
	drawWithMarker("white", "purple");
});
document.getElementById("changeColorToWhiteYellow").addEventListener('click', function(){
	updateInterface("marker", document.getElementById("changeColorToWhiteYellow"));
	drawWithMarker("white", "yellow");
});
document.getElementById("changeColorToWhitePink").addEventListener('click', function(){
	updateInterface("marker", document.getElementById("changeColorToWhitePink"));
	drawWithMarker("white", "pink");
});

document.getElementById("changeColorToWhiteBlue").addEventListener('click', function(){
	updateInterface("marker", document.getElementById("changeColorToWhiteBlue"));
	drawWithMarker("white", "rgb(142,222,249)");
});

document.getElementById("changeColorToSkyBlue").addEventListener('click', function(){
	updateInterface("marker", document.getElementById("changeColorToSkyBlue"));
	drawWithMarker("rgb(142,222,249)", "rgb(142,222,249)");
});

document.getElementById("changeColorToOrange").addEventListener('click', function(){
	updateInterface("marker", document.getElementById("changeColorToOrange"));
	drawWithMarker("rgb(244,157,55)", "rgb(244,157,55)");
});

document.getElementById("changeColorToBlack").addEventListener('click', function(){
	updateInterface("marker", document.getElementById("changeColorToBlack"));
	drawWithMarker("rgb(0,0,0)", "rgb(0,0,0)");
});

document.getElementById("changeColorToRed").addEventListener('click', function(){
	updateInterface("marker", document.getElementById("changeColorToRed"));
	drawWithMarker("rgb(255,34,34)", "rgb(255,34,34)");
});

document.getElementById("changeColorToWhite").addEventListener('click', function(){
	updateInterface("marker", document.getElementById("changeColorToWhite"));
	drawWithMarker("white", "white");
});

document.getElementById("changeColorToMint").addEventListener('click', function(){
	updateInterface("marker", document.getElementById("changeColorToMint"));
	drawWithMarker("rgb(22, 230, 188)", "rgb(22, 230, 188)");
});

document.getElementById("changeColorToLightYellow").addEventListener('click', function(){
	updateInterface("marker", document.getElementById("changeColorToLightYellow"));
	drawWithMarker("rgb(250, 255, 168)", "rgb(250, 255, 168)");
});

document.getElementById("changeColorToLavender").addEventListener('click', function(){
	updateInterface("marker", document.getElementById("changeColorToLavender"));
	drawWithMarker("rgb(249, 183, 248)", "rgb(249, 183, 248)");
});


/**********************************************************************************
Brushes
***********************************************************************************/


document.getElementById("changeToolToBrush").addEventListener('click', function(){
	updateInterface("brush", document.getElementById("changeToolToBrush"));
	drawWithBrush(document.getElementById("changeToolToBrush").childNodes[0].src);
});

document.getElementById("changeToolToBrush2").addEventListener('click', function(){
	updateInterface("brush", document.getElementById("changeToolToBrush2"));
	drawWithBrush(document.getElementById("changeToolToBrush2").childNodes[0].src);
});

document.getElementById("changeToolToBrush3").addEventListener('click', function(){
	updateInterface("brush", document.getElementById("changeToolToBrush3"));
	drawWithBrush(document.getElementById("changeToolToBrush3").childNodes[0].src);
});

document.getElementById("changeToolToBlueSparkleBrush").addEventListener('click', function(){
	updateInterface("brush", document.getElementById("changeToolToBlueSparkleBrush"));
	drawWithBrush(document.getElementById("changeToolToBlueSparkleBrush").childNodes[0].src);
});

document.getElementById("changeToolToPinkSparkleBrush").addEventListener('click', function(){
	updateInterface("brush", document.getElementById("changeToolToPinkSparkleBrush"));
	drawWithBrush(document.getElementById("changeToolToPinkSparkleBrush").childNodes[0].src);
});


/**********************************************************************************
Stamps
***********************************************************************************/

document.getElementById("changeStamp2").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("changeStamp2"));
	drawStamp(document.getElementById("changeStamp2").childNodes[0].src);
});
document.getElementById("changeStamp3").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("changeStamp3"));
	drawStamp(document.getElementById("changeStamp3").childNodes[0].src);
});
document.getElementById("changeStamp4").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("changeStamp4"));
	drawStamp(document.getElementById("changeStamp4").childNodes[0].src);
});

document.getElementById("spottedHeartStamp").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("spottedHeartStamp"));
	drawStamp(document.getElementById("spottedHeartStamp").childNodes[0].src);
});

document.getElementById("pearlHeartStamp").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("pearlHeartStamp"));
	drawStamp(document.getElementById("pearlHeartStamp").childNodes[0].src);
});

document.getElementById("cherryStamp").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("cherryStamp"));
	drawStamp(document.getElementById("cherryStamp").childNodes[0].src);
});

document.getElementById("crownStamp").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("crownStamp"));
	drawStamp(document.getElementById("crownStamp").childNodes[0].src);
});

document.getElementById("bowtieStamp").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("bowtieStamp"));
	drawStamp(document.getElementById("bowtieStamp").childNodes[0].src);
});

document.getElementById("whiteBowStamp").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("whiteBowStamp"));
	drawStamp(document.getElementById("whiteBowStamp").childNodes[0].src);
});

document.getElementById("kittyBowStamp").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("kittyBowStamp"));
	drawStamp(document.getElementById("kittyBowStamp").childNodes[0].src);
});

document.getElementById("diamondStamp").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("diamondStamp"));
	drawStamp(document.getElementById("diamondStamp").childNodes[0].src);
});

document.getElementById("pinkDiamondStamp").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("pinkDiamondStamp"));
	drawStamp(document.getElementById("pinkDiamondStamp").childNodes[0].src);
});

document.getElementById("roseStamp").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("roseStamp"));
	drawStamp(document.getElementById("roseStamp").childNodes[0].src);
});

document.getElementById("pinkCrownStamp").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("pinkCrownStamp"));
	drawStamp(document.getElementById("pinkCrownStamp").childNodes[0].src);
});

document.getElementById("blueSparkleStamp").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("blueSparkleStamp"));
	drawStamp(document.getElementById("blueSparkleStamp").childNodes[0].src);
});

document.getElementById("pinkSparkleStamp").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("pinkSparkleStamp"));
	drawStamp(document.getElementById("pinkSparkleStamp").childNodes[0].src);
});

document.getElementById("orangeSparkleStamp").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("orangeSparkleStamp"));
	drawStamp(document.getElementById("orangeSparkleStamp").childNodes[0].src);
});

document.getElementById("yellowSparkleStamp").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("yellowSparkleStamp"));
	drawStamp(document.getElementById("yellowSparkleStamp").childNodes[0].src);
});

document.getElementById("daisyStamp").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("daisyStamp"));
	drawStamp(document.getElementById("daisyStamp").childNodes[0].src);
});

document.getElementById("pearlStamp").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("pearlStamp"));
	drawStamp(document.getElementById("pearlStamp").childNodes[0].src);
});

document.getElementById("pinkGlassesStamp").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("pinkGlassesStamp"));
	drawStamp(document.getElementById("pinkGlassesStamp").childNodes[0].src);
});


document.getElementById("glassesStamp").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("glassesStamp"));
	drawStamp(document.getElementById("glassesStamp").childNodes[0].src);
});

document.getElementById("heartDiamondStamp").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("heartDiamondStamp"));
	drawStamp(document.getElementById("heartDiamondStamp").childNodes[0].src);
});

document.getElementById("stacheStamp").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("stacheStamp"));
	drawStamp(document.getElementById("stacheStamp").childNodes[0].src);
});

document.getElementById("bearStamp").addEventListener('click', function() {
	updateInterface("stamp", document.getElementById("bearStamp"));
	drawStamp(document.getElementById("bearStamp").childNodes[0].src);
});

/**********************************************************************************
Size changes
***********************************************************************************/

document.getElementById("changeSizeToSmall").addEventListener('click', function(){
	if (activeTool == "marker") {
		ctx.lineWidth = markerSmall;
		ctx.shadowBlur = markerSmall;
		activeMarkerSize = markerSmall;
	} else if (activeTool == "brush") {
		activeBrushSize = brushSmall;
		//console.log("changing brush size to small: ", activeBrushSize);
	} else {
		activeStampSize = stampSmall;
	}
	
	updateActiveSizeElement(document.getElementById("changeSizeToSmall"));
});
document.getElementById("changeSizeToMedium").addEventListener('click', function(){
	if (activeTool == "marker") {
		ctx.lineWidth = markerMedium;
		ctx.shadowBlur = markerMedium;
		activeMarkerSize = markerMedium;
	} else if (activeTool == "brush") {
		activeBrushSize = brushMedium;
	} else {
		activeStampSize = stampMedium;
	}
	
	updateActiveSizeElement(document.getElementById("changeSizeToMedium"));
});
document.getElementById("changeSizeToLarge").addEventListener('click', function(){
	if (activeTool == "marker") {
		ctx.lineWidth = markerLarge;
		ctx.shadowBlur = markerLarge;
		activeMarkerSize = markerLarge;
	} else if (activeTool == "brush") {
		activeBrushSize = brushLarge;
	} else {
		activeStampSize = stampLarge;
	}
	
	updateActiveSizeElement(document.getElementById("changeSizeToLarge"));
});
document.getElementById("changeSizeToXLarge").addEventListener('click', function(){
	if (activeTool == "marker") {
		ctx.lineWidth = markerXlarge;
		ctx.shadowBlur = markerXlarge;
		activeMarkerSize = markerXlarge;
	} else if (activeTool == "brush") {
		activeBrushSize = brushXlarge;
	} else {
		activeStampSize = stampXlarge;
	}

	updateActiveSizeElement(document.getElementById("changeSizeToXLarge"));
});


/**********************************************************************************
Canvas-wide functions
***********************************************************************************/

//Resets the canvas
document.getElementById("clear").addEventListener('click', function(){
	el.width = el.width;
	selectDefaults();
	document.getElementById("ui-id-1").click();
});


function selectDefaults() {
	//the sizes of the marker stuff will be taken care of by the clicks.
	//you still need to update the sizes of the other tools.

	activeBrushSize = brushMedium;
	activeStampSize = stampMedium;
	document.getElementById("changeColorToPurple").click();
	document.getElementById("changeSizeToMedium").click();
}



function setUpCanvas() {
	
	ctx.lineWidth = 5; 
	ctx.shadowBlur = 5;
	ctx.lineJoin = ctx.lineCap = 'round';

	activeSizeElement = document.getElementById("changeSizeToMedium");
	activeBrushOrStampElement = document.getElementById("changeColorToPurple");

	activeBrushOrStampElement.className = "button-active";
	activeSizeElement.className = "button-active";
	activeMarkerSize = markerMedium;
	activeBrushSize = brushMedium;
	activeStampSize = stampMedium;
	activeTool = "marker";

	updateCursor("marker");
	drawWithMarker("purple", "purple");

};

/**********************************************************************************
Interface updates
***********************************************************************************/

function updateInterface(tool, button){
	if (tool == "eraser") {
		ctx.globalCompositeOperation = "destination-out";
		activeTool = "marker";
		updateCursor("eraser");
		drawWithMarker("purple", "purple");
		updateActiveBrushOrStampElement(button);
	} else if (tool == "marker") {
		ctx.globalCompositeOperation = "source-over";
		activeTool = "marker";
		updateCursor("marker");
		updateActiveBrushOrStampElement(button);

		//marker size stuff
		if (activeMarkerSize == markerSmall) {
			updateActiveSizeElement(document.getElementById("changeSizeToSmall"));
		} else if (activeMarkerSize == markerMedium) {
			updateActiveSizeElement(document.getElementById("changeSizeToMedium"));
		} else if (activeMarkerSize == markerLarge) {
			updateActiveSizeElement(document.getElementById("changeSizeToLarge"));
		} else {
			updateActiveSizeElement(document.getElementById("changeSizeToXLarge"));
		}
	} else if (tool == "brush") {
		ctx.globalCompositeOperation = "source-over";
		activeTool = "brush";
		updateCursor("brush");

		drawWithBrush(button.childNodes[0].src);
		updateActiveBrushOrStampElement(button);

		//brushSize stuff
		if (activeBrushSize == brushSmall) {
			updateActiveSizeElement(document.getElementById("changeSizeToSmall"));
		} else if (activeBrushSize == brushMedium) {
			updateActiveSizeElement(document.getElementById("changeSizeToMedium"));
		} else if (activeBrushSize == brushLarge) {
			updateActiveSizeElement(document.getElementById("changeSizeToLarge"));
		} else {
			updateActiveSizeElement(document.getElementById("changeSizeToXLarge"));
		}
	} else {
		ctx.globalCompositeOperation = "source-over";
		activeTool = "stamp";
		updateCursor("stamp");
		drawStamp(button.childNodes[0].src);
		updateActiveBrushOrStampElement(button);

		//stampSize stuff
		if (activeStampSize == stampSmall) {
			updateActiveSizeElement(document.getElementById("changeSizeToSmall"));
		} else if (activeStampSize == stampMedium) {
			updateActiveSizeElement(document.getElementById("changeSizeToMedium"));
		} else if (activeStampSize == stampLarge) {
			updateActiveSizeElement(document.getElementById("changeSizeToLarge"));
		} else {
			updateActiveSizeElement(document.getElementById("changeSizeToXLarge"));
		}
	}
}

function updateCursor(type) {
	if (type == "brush") {
		document.getElementById("c").className = "cursor-brush";
	} else if (type == "stamp") {
		document.getElementById("c").className = "cursor-stamp";
	} else if (type == "marker") {
		document.getElementById("c").className = "cursor-marker";
	} else {
		document.getElementById("c").className = "cursor-eraser";
	}
};

function updateActiveSizeElement(newElement) {
	activeSizeElement.className = "";
	newElement.className = "button-active";
	activeSizeElement = newElement;
	activeSizeElement.blur(); //I don't want focus showing up b/c you have multiple things selected
};

function updateActiveBrushOrStampElement(newElement) {
	//console.log(newElement);

	//all this logic is to make sure the header is lighted/dimmed when selecting the eraser
	if (newElement == document.getElementById("changeToolToEraser")) {
		var headerToBeUpdated = document.getElementById("accordion").childNodes;
		for (var i = 1; i< headerToBeUpdated.length; i += 4) {
			//console.log(i, headerToBeUpdated[i]);
			 if (headerToBeUpdated[i].classList.contains("ui-state-active")) {
				var buttonToBeUpdated = headerToBeUpdated[i].childNodes[1];
				//console.log(buttonToBeUpdated);
				buttonToBeUpdated.classList.add("accordion-button-adjustment");
			}
		}
	} else {
		var headerToBeUpdated = document.getElementById("accordion").childNodes;
		//console.log(headerToBeUpdated);
		for (var i = 1; i< headerToBeUpdated.length; i += 4) {
			//console.log(i, headerToBeUpdated[i]);
			 if (headerToBeUpdated[i].classList.contains("ui-state-active")) {
				var buttonToBeUpdated = headerToBeUpdated[i].childNodes[1];
				//console.log(buttonToBeUpdated);
				buttonToBeUpdated.classList.remove("accordion-button-adjustment");
			}
		}
	}
	activeBrushOrStampElement.className = "";
	newElement.className = "button-active";
	activeBrushOrStampElement = newElement;
	activeBrushOrStampElement.blur(); //I don't want focus showing up b/c you have multiple things selected
};

/**********************************************************************************
Drawing functions
***********************************************************************************/

function drawStamp(src) {
	var img = new Image();
	img.src = src;

	el.onmousedown = function(e) {
		//the minuses are offsets
		ctx.drawImage(img, e.pageX-200, e.pageY-200, activeStampSize, activeStampSize); //200s for offset
	};
};

//MAKE A SPACING PARAMETER. EVERY BRUSH HAS DIFFERENT SPACING!!!

function drawWithBrush(src) {
	var img = new Image();
	img.src = src;

	function distanceBetween(point1, point2) {
		return Math.sqrt(Math.pow(point2.x - point1.x, 2) + Math.pow(point2.y - point1.y, 2));
	};
	function angleBetween(point1, point2) {
		return Math.atan2( point2.x - point1.x, point2.y - point1.y );
	};
	
	ctx.lineJoin = ctx.lineCap = 'round';

	var isDrawing, lastPoint;

	el.onmousedown = function(e) {
		//console.log("here?");
		isDrawing = true;
		lastPoint = { x: e.pageX-160, y: e.pageY-160}; //changed clientX to pageX. 160s for offset

		//make sure there's no shadow, in case you used the marker
		ctx.shadowBlur = 0;
	};

	//

	el.onmousemove = function(e) {
		if (!isDrawing) return;

		var currentPoint = { x: e.pageX-160, y: e.pageY-160}; //changed clientX to pageX
		var dist = distanceBetween(lastPoint, currentPoint);
		var angle = angleBetween(lastPoint, currentPoint);

		//The 100 is what dictates how far apart the images are
		for (var i = 0; i < dist; i+= 100) {
			x = lastPoint.x + (Math.sin(angle) * i) - 25;
			y = lastPoint.y + (Math.cos(angle) * i) - 25;
			ctx.drawImage(img, x, y, activeBrushSize, activeBrushSize); //the 32's are FOR SCALING!
		}

		lastPoint = currentPoint;
	};

	el.onmouseup = function() {
		isDrawing = false;
	};

};

function drawWithMarker(color, shadowColor) {

	var isDrawing;


	el.onmousedown = function(e) {
	  isDrawing = true;
	  //moving to onload
	  
	  // ctx.lineJoin = ctx.lineCap = 'round';
	  ctx.moveTo(e.pageX-180, e.pageY-180); //changed clientX to pageX 180s for offset
	  ctx.beginPath();
	};
	el.onmousemove = function(e) {
	  if (isDrawing) {
	    ctx.strokeStyle = color;
	    ctx.shadowColor = shadowColor;
	    ctx.lineWidth = activeMarkerSize; //have to set these again because they dont show up after the brush..not sure why
		ctx.shadowBlur = ctx.lineWidth; //orignally set this to "activeSize" but it didn't like it?
		// console.log("linewidth", ctx.lineWidth);
		// console.log("shadow", ctx.shadowBlur);



	    //THIS WORKS FINE IF THE TOOL BFORE YOU IS A MARKER. NOT OK IF ITS A BRUSH
	    //(LOOKS LIKE NO SETTINGS IF AFTER BRUSH). OK if you select a size fn.
	    //FIGURE OUT WHATS UP

	    ctx.lineTo(e.pageX-180, e.pageY-165); //the minuses are for offsets. //changed clientX to pageX
	    ctx.stroke();
	  }
	};
	el.onmouseup = function() {
	  isDrawing = false;
	};
};

/**********************************************************************************
Saving, downloading, and emailing functions
***********************************************************************************/

function save_image(){
	//Makes a new canvas for saving
	var copyForDownloading = document.createElement('canvas');
	var ctxCopyForDownloading = copyForDownloading.getContext('2d');
	ctxCopyForDownloading.canvas.width = document.getElementById("photo").width;
	ctxCopyForDownloading.canvas.height = document.getElementById("photo").height;

	//Copies the 2 working canvases onto the canvas for saving
	ctxCopyForDownloading.drawImage(document.getElementById("photo"), 0, 0);
	ctxCopyForDownloading.drawImage(document.getElementById("c"), 0, 0);

	//Sends the canvas for saving to the backend for storage in the gallery
	$.ajax({
		type: "POST",
		url: "{{ url_for('update_purikura') }}",
		data: { filename: '{{ filename }}', updated_src: copyForDownloading.toDataURL('image/jpeg', 1.0) },
		success: function(response) {
			//console.log(response);
		},
		error: function(error) {
			//console.log(error)
		}

	});
}

//Saves image in gallery
document.getElementById('save').addEventListener('click', function(){

	save_image();
});


//Downloads image to disk
document.getElementById('download').addEventListener('click', function(){
	
	//Makes a new canvas for downloading
	var copyForDownloading = document.createElement('canvas');
	var ctxCopyForDownloading = copyForDownloading.getContext('2d');
	ctxCopyForDownloading.canvas.width = document.getElementById("photo").width;
	ctxCopyForDownloading.canvas.height = document.getElementById("photo").height;

	//Copies the 2 working canvases onto the canvas for saving
	ctxCopyForDownloading.drawImage(document.getElementById("photo"), 0, 0);
	ctxCopyForDownloading.drawImage(document.getElementById("c"), 0, 0);

	//Converts the canvas to data and names the new file
	this.href = copyForDownloading.toDataURL();
	this.download = 'purikura.jpg';
});



//Sends image to user-specified email address
$("#emailImage").submit(function(e){
	console.log('sent email...?');
	
	save_image();

	//Tells backend to send email with specfied address
	$.ajax({
		type: "POST",
		url: "{{ url_for('send_mail') }}",
		data: $("#emailImage").serialize(),
		success: function(response) {
			//console.log(response);
		},
		error: function(error) {
			//console.log(error)
		}

	});

	// $('#emailModal').modal('hide');
	e.preventDefault();
	
});

// $('#submitButton').on('click', function() { 
//   $('.modal').modal('hide');
// });

document.getElementById('submitButton').addEventListener('click', function(){
	$('#emailModal').modal('hide');
});

$(function () {
  $('[data-toggle="tooltip"]').tooltip({
  	'placement':'top'
  });
});

$('[data-toggle="popover"]').popover({
	trigger: 'hover',
	'placement': 'top'
});

// </script>

{% endblock %}